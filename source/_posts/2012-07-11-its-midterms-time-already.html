---
layout: post
title: It's midterms time (already?!)
tags:
- gsoc
- gsoc2012
- journal
- midterm
- pygame
- python
- sprite
status: publish
type: post
published: true
meta: {}
---
<p>I&rsquo;ve been very busy in the past couple of months. It&rsquo;s been very educating, very productive &ndash; yet the time flew way too quickly!</p><p>Outside of <a href="http://www.google-melange.com/gsoc/proposal/review/google/gsoc2012/n0nick/28002">my GSoC Pygame project</a>, I have been finishing the semester and stepping into a final tests period which proves to be the hardest yet. I don&rsquo;t remember ever being so exhausted day after day when I get home.</p><p>This is the main reason I have to admit that my project doesn&rsquo;t quiet meet the plans to have most of the new Sprite class ready for the midterm evaluations.</p><p>Still, I have some good progress to show for, plus I&rsquo;m fairly sure that after these hectic finals will pass, I will be able to catch up with my plans.</p><h2>Let&rsquo;s show off, then.</h2><p>The <a href="http://dotfile.n0nick.net/pygame-planned-sprites-work">sprites work plan</a> consisted of adding 7 new features to Pygame&rsquo;s <a href="https://github.com/n0nick/pygame-sprites/blob/master/sprite.py">Sprite class</a>.<br />I wrote about implementing 2 of these (<em>Anchor points</em> and <em>Better positioning</em>) in my last post, <a href="http://dotfile.n0nick.net/baby-steps-with-pygame-sprites-anchors-and-po">Baby steps with Pygame sprites</a>.</p><p>Since then, I have finished implementing 2 more, <em>Visual attributes</em> and <em>Aggregated Sprite</em>, which I&rsquo;ll describe below, and also wrote most of the underlying code needed for the rest of the features.</p><p>You can check out my work in progress, including everything described here, in the <a href="https://github.com/n0nick/pygame-sprites"><code>pygame-sprites</code></a> GitHub repository.</p><h3>New visual attributes</h3><p>My <code>Sprite</code> class now has several few new properties: <code>visibility</code>, <code>scale</code> and <code>rotate</code>, which control the way the sprite&rsquo;s image is drawn on the screen:</p><ul><li><code>visibility</code> decides whether the image should be rendered  or not. Default is <code>true</code>.</li><li><code>scale</code> is a float value determining the ratio between the size of the originally supplied image and the required size on the screen. Default is <code>1</code>.</li><li><code>rotate</code> is an integer defining the degree by which to rotate the original image. Default is <code>0</code>.</li></ul><p><img src="http://cl.ly/26103X3c3k3E12323b0j/Screen%20Shot%202012-07-11%20at%2011.25.45%20PM.png" alt="image" /><img src="http://cl.ly/1s0X0t3b0o2j15023e0y/Screen%20Shot%202012-07-11%20at%2011.25.49%20PM.png" alt="image" /><img src="http://cl.ly/1A3N0N0I1g341N1n0p1r/Screen%20Shot%202012-07-11%20at%2011.25.57%20PM.png" alt="image" /></p><p>To implement these attributes I used Python&rsquo;s <a href="http://docs.python.org/library/functions.html#property"><code>property</code> notation</a>, which allows me to set custom getters and setters for standard class properties.<br />In addition to the visual attributes, the sprite&rsquo;s <code>image</code> attribute also uses the new notation, so that its custom getter function would return the transformed image, if a transformation is needed.</p><p>The visual transformations are done using <a href="http://www.pygame.org/docs/ref/transform.html"><code>Pygame.transform</code></a>&rsquo;s methods.</p><h3>Sprites drawing themselves</h3><p>In order to support features such as the <code>visibility</code> attribute, automatic dirty rendering and others, I changed the way we actually draw the sprites, implementing the <a href="http://en.wikipedia.org/wiki/Composite_pattern">composite pattern</a>.<br /><code>Sprite</code>&rsquo;s new method <code>draw</code> gets a surface as an argument and is responsible to draw the current sprite onto it.</p><p><code>Group</code>&rsquo;s old <code>draw</code> method now uses the group&rsquo;s sprites' <code>draw</code> method if it&rsquo;s available. Legacy code is still supported by preserving the old functionality if no <code>draw</code> method is found.</p><h3>Aggregated sprites</h3><p>I wrote a new class, <code>AggregatedSprite</code>, which extends my <code>Sprite</code> class and adds the functionality of holding a list of child sprites and propagating any change to them.<br />In a sense, an aggregated sprite is something between a sprite and a sprites group.</p><p>The <code>AggregatedSprite</code> class has a <code>sprites</code> property which holds the list of child sprites. This is a basic Python list which could be modified normally.<br />Its <code>draw</code> method calls all of the child sprites' <code>draw</code>, like a group.</p><p>Setting a value to a visual attribute of an aggregated sprite would propagate this value down to all the child sprites.<br />This was done in <code>Sprite</code> by wrapping the visual attributes' setters with a method that would call an <code>on_visual_set</code> callback if one exists.<br /><code>AggregatedSprite</code> uses this callback to set the make the same attribute change to all the child sprites.</p><p>Setting an aggregated sprite&rsquo;s <code>position</code> to <code>(x, y)</code> would use these values as offsets for all of the child sprites, that is, move them all from their original position by <code>(x, y)</code>.</p><p><img src="http://cl.ly/2G0b352Q3Q1Q08020w1u/Screen%20Shot%202012-07-11%20at%2011.28.07%20PM.png" alt="image" /><img src="http://cl.ly/2p2B0M0N3u1F1M3E2W0N/Screen%20Shot%202012-07-11%20at%2011.28.15%20PM.png" alt="image" /><img src="http://cl.ly/2s3k1j3M1j2o2d2t3521/Screen%20Shot%202012-07-11%20at%2011.28.26%20PM.png" alt="image" /></p><h3>Still missing</h3><p>I&rsquo;m still missing 3 features here: <em>Automatic dirty rendering</em>, <em>Sprite picking</em> and <em>Smarter layers</em>.</p><p>The move to composite drawing of sprites holds most of the major changes needed for dirty rendering and layered groups, and so there&rsquo;s little work left for these two to be done as well.</p><p>I still have to do some research on implementing <em>Sprite picking</em>, but I&rsquo;m sure it will be pretty simple to do.</p><p>Also, <strong>tests</strong>.<br />Early on, I saw that going full <a href="http://en.wikipedia.org/wiki/Test-driven_development">TDD</a> is slowing me down, and I wanted to get stuff working as soon as possible. So I ditched writing tests until everything is more stable.<br />On of my most important tasks once I&rsquo;m done with my last final would be to write tests for all of my changes.<br />This is a big task, but hopefully I could make use code of the demo games I wrote for each feature.</p><p>Some other <strong>TODOs</strong>:</p><ol><li>Anchor points: Use Rect&rsquo;s anchor constants instead of my own.</li><li>Anchor points: Handle negative values.</li><li>Positions: Handle float values.</li><li>Visual attributes: Add <em>crop rectangle</em> attribute.</li><li>Some code cleanup, and way more documentation.</li></ol><h2>That&rsquo;s about it.</h2><p>I can&rsquo;t wait until I&rsquo;m done with my finals so that I can take this project to the next level (and the one after that, too).</p><p>Oh, one more TODO note to self: Blog about the project more. It helps.</p><p>As always, feel free to contact me with any question or idea, either here, by email or on #pygame in Freenode.</p>
